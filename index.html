<!doctype html>
<html>
  <head>
    <title>Session Affinity Test</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font: 13px Helvetica, Arial; }
      .Status { text-align: center; font-size: 48px; font-weight: 100; padding: 24px; line-height: 2; }
    </style>
  </head>
  <body>

    <div class='Status'>
      <p id='socketIoStatus'></p>
      <p id='sockJsStatus'></p>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="//cdn.jsdelivr.net/sockjs/0.3.4/sockjs.min.js"></script>

    <script>

      var ioStatus = status('Socket.io', 'socketIoStatus');
      var sockStatus = status('SockJS', 'sockJsStatus');
      var socket = io();
      var sock = new SockJS('/sockjs');

      ioStatus('connecting');
      sockStatus('connecting');

      socket
        .on('connect', onConnect)
        .on('error', onError)
        .on('disconnect', onDisconnect)
        .on('reconnect', onConnect)
        .on('reconnect_failed', onDisconnect);

      sock.onopen = function() {
        sockStatus('connected');
      };

      sock.onclose = function() {
        sockStatus('disconnected');
      };

      function status(label, id) {
        var el = document.getElementById(id);
        return function(status) {
          el.innerHTML = label + ': ' + status;
        }
      }

      function onConnect() {
        ioStatus('connected');
      }

      function onError(err) {
        console.log('error:', err);
      }

      function onDisconnect() {
        ioStatus('disconnected');
      }

    </script>
  </body>
</html>
